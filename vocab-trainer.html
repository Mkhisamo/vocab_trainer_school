<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–¢—Ä–µ–Ω–∞–∂—ë—Ä —Å–ª–æ–≤</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    body { margin: 0; background: #f6f7f9; color: #111; }
    header { padding: 16px 20px; background: #fff; border-bottom: 1px solid #e5e7eb; position: sticky; top:0; z-index: 5;}
    h1 { font-size: 18px; margin: 0; }
    main { max-width: 960px; margin: 20px auto; padding: 0 16px 40px; }

    .card { background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:16px; }
    .grid { display:grid; gap:16px; }
    @media (min-width:900px){ .grid-2 { grid-template-columns: 1fr 1fr; } }

    label { display:block; font-size: 13px; color:#555; margin-bottom:6px; }
    input, select, textarea {
      width:100%; box-sizing:border-box; padding:10px 12px; border:1px solid #d1d5db; border-radius:8px; background:#fff;
    }
    button { border:1px solid #d1d5db; background:#fff; padding:10px 14px; border-radius:10px; cursor:pointer; }
    button.primary { background:#111; color:#fff; border-color:#111; }
    button.ghost { background:transparent; }
    .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .tag { padding:4px 8px; background:#f1f5f9; border-radius:999px; font-size:12px; }
    .muted { color:#6b7280; font-size: 13px; }
    .wordlist { max-height: 260px; overflow:auto; border-top:1px dashed #e5e7eb; margin-top:10px; padding-top:10px;}
    .worditem { display:flex; justify-content:space-between; padding:6px 0; border-bottom:1px dashed #f0f0f0; }
    .worditem:last-child{ border-bottom:none; }
    .q-word { font-size:26px; margin:4px 0 10px; }
    .answers { display:grid; gap:10px; }
    .answers button { text-align:left; }
    .ok { background:#ecfdf5; border-color:#10b981; }
    .bad { background:#fef2f2; border-color:#ef4444; }
    .pill { padding:6px 10px; background:#f3f4f6; border-radius:999px; }
    .split { display:flex; justify-content:space-between; align-items:center; gap:10px; }
    .danger { border-color:#ef4444; color:#ef4444; }
    details summary { cursor:pointer; }
    .small { font-size:12px; }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background:#f3f4f6; padding:2px 6px; border-radius:6px; }
  </style>
</head>
<body>
  <header class="split">
    <h1>–¢—Ä–µ–Ω–∞–∂—ë—Ä —Å–ª–æ–≤</h1>
    <div class="row">
      <button id="exportBtn">–≠–∫—Å–ø–æ—Ä—Ç</button>
      <input type="file" id="importFile" accept=".json" style="display:none" />
      <button id="importBtn">–ò–º–ø–æ—Ä—Ç</button>
      <button id="resetBtn" class="danger">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
    </div>
  </header>

  <main class="grid grid-2">
    <!-- –ü–∞–Ω–µ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
    <section class="card">
      <h2 style="margin-top:0">–ë–∞–∑–∞ —Å–ª–æ–≤</h2>
      <div class="grid">
        <div class="grid">
          <div>
            <label>–°–ª–æ–≤–æ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º</label>
            <input id="en" placeholder="cat" />
          </div>
          <div>
            <label>–ü–µ—Ä–µ–≤–æ–¥ (–ø–æ-—Ä—É—Å—Å–∫–∏)</label>
            <input id="ru" placeholder="–∫–æ—Ç" />
          </div>
          <div>
            <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, Animals, School‚Ä¶)</label>
            <input id="cat" placeholder="Animals" />
          </div>
        </div>
        <div class="row">
          <button id="addBtn" class="primary">–î–æ–±–∞–≤–∏—Ç—å</button>
          <span class="muted">–ü–æ–¥—Å–∫–∞–∑–∫–∞: –Ω–∞–∂–º–∏—Ç–µ <span class="kbd">Enter</span> –≤ –ª—é–±–æ–º –ø–æ–ª–µ</span>
        </div>
      </div>

      <div class="split" style="margin-top:16px;">
        <div class="row">
          <span class="muted">–í—Å–µ–≥–æ —Å–ª–æ–≤: <b id="count">0</b></span>
          <span class="muted">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏: <span id="cats"></span></span>
        </div>
        <div class="row">
          <input id="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ —Å–ª–æ–≤–∞—Ä—é‚Ä¶" />
        </div>
      </div>

      <div class="wordlist" id="list"></div>
    </section>

    <!-- –ü–∞–Ω–µ–ª—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ -->
    <section class="card">
      <h2 style="margin-top:0">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</h2>
      <div class="grid">
        <div class="grid">
          <div>
            <label>–†–µ–∂–∏–º –≤–æ–ø—Ä–æ—Å–∞</label>
            <select id="mode">
              <option value="en2ru">–ü–æ–∫–∞–∑–∞—Ç—å –∞–Ω–≥–ª–∏–π—Å–∫–æ–µ ‚Üí –≤—ã–±—Ä–∞—Ç—å —Ä—É—Å—Å–∫–∏–π</option>
              <option value="ru2en">–ü–æ–∫–∞–∑–∞—Ç—å —Ä—É—Å—Å–∫–∏–π ‚Üí –≤—ã–±—Ä–∞—Ç—å –∞–Ω–≥–ª–∏–π—Å–∫–∏–π</option>
              <option value="mix">–°–º–µ—à–∞–Ω–Ω—ã–π</option>
            </select>
          </div>
          <div>
            <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</label>
            <select id="filterCat"></select>
          </div>
          <div>
            <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤</label>
            <select id="quizLen">
              <option>5</option><option selected>10</option><option>15</option><option>20</option><option>30</option>
            </select>
          </div>
        </div>
        <div class="row">
          <button id="startBtn" class="primary">–°—Ç–∞—Ä—Ç</button>
          <span class="muted">–û—á–∫–∏: <b id="score">0</b> –∏–∑ <b id="total">0</b></span>
        </div>
      </div>

      <hr style="border:none;border-top:1px solid #eee;margin:14px 0" />

      <div id="quizArea" style="display:none">
        <div class="split">
          <div class="row">
            <span class="pill" id="qCounter">1/10</span>
            <span class="pill" id="qCat"></span>
            <span class="pill small" id="qHint"></span>
          </div>
          <button id="skipBtn" class="ghost">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
        </div>

        <div class="q-word" id="qWord">word</div>
        <div class="answers" id="answers"></div>
        <div class="row" style="margin-top:10px">
          <button id="nextBtn" class="primary" disabled>–î–∞–ª–µ–µ</button>
          <span class="muted" id="feedback"></span>
        </div>
      </div>
    </section>

    <section class="card" style="grid-column:1/-1">
      <details>
        <summary><b>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ —á—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å</b></summary>
        <ul>
          <li>–°–ª–æ–≤–∞ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ (localStorage). –ú–æ–∂–Ω–æ <b>–≠–∫—Å–ø–æ—Ä—Ç/–ò–º–ø–æ—Ä—Ç</b> –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞.</li>
          <li>–ï—Å—Ç—å —Ñ–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º, –ø–æ–∏—Å–∫, –≤—ã–±–æ—Ä –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è (EN‚ÜíRU, RU‚ÜíEN, MIX).</li>
          <li>–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–∞ –ø–æ–¥–±–∏—Ä–∞—é—Ç—Å—è –∏–∑ –≤—Å–µ–π –±–∞–∑—ã, –≤—Å–µ–≥–¥–∞ 4 –æ–ø—Ü–∏–∏ (1 –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è + 3 —Å–ª—É—á–∞–π–Ω—ã—Ö).</li>
          <li>–ò–¥–µ–∏ –Ω–∞ –±—É–¥—É—â–µ–µ: ¬´—Å–ª–æ–∂–Ω—ã–µ —Å–ª–æ–≤–∞¬ª (–æ—à–∏–±—Å—è ‚Üí —á–∞—â–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å), –æ–∑–≤—É—á–∫–∞, –∫–∞—Ä—Ç–æ—á–∫–∏, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–Ω—è–º.</li>
        </ul>
      </details>
    </section>
  </main>

  <script>
  // ======= –•—Ä–∞–Ω–∏–ª–∏—â–µ =======
  const KEY = "vocab.trainer.words.v1";
  const $ = (id) => document.getElementById(id);
  const state = {
    words: loadWords(),
    quiz: null,
    current: 0,
    score: 0,
  };

  function loadWords(){
    try {
      const raw = localStorage.getItem(KEY);
      if (raw) return JSON.parse(raw);
    } catch(e){}
    // —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä
    return [
      {en:"cat", ru:"–∫–æ—Ç", cat:"Animals"},
      {en:"dog", ru:"—Å–æ–±–∞–∫–∞", cat:"Animals"},
      {en:"school", ru:"—à–∫–æ–ª–∞", cat:"School"},
      {en:"teacher", ru:"—É—á–∏—Ç–µ–ª—å", cat:"School"},
      {en:"book", ru:"–∫–Ω–∏–≥–∞", cat:"School"},
      {en:"bird", ru:"–ø—Ç–∏—Ü–∞", cat:"Animals"},
    ];
  }
  function saveWords(){ localStorage.setItem(KEY, JSON.stringify(state.words)); }

  // ======= UI –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è =======
  function renderCounts(){
    $("count").textContent = state.words.length;
    const cats = [...new Set(state.words.map(w=>w.cat).filter(Boolean))].sort();
    $("cats").innerHTML = cats.map(c=>`<span class="tag">${c}</span>`).join(" ");
    // –≤—ã–ø–∞–¥–∞—é—â–∏–π —Ñ–∏–ª—å—Ç—Ä
    const filter = $("filterCat");
    const current = filter.value;
    filter.innerHTML = `<option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>` + cats.map(c=>`<option>${c}</option>`).join("");
    if ([...filter.options].some(o=>o.value===current)) filter.value=current;
  }

  function renderList(){
    const q = $("search").value.trim().toLowerCase();
    const rows = state.words
      .filter(w => !q || w.en.toLowerCase().includes(q) || w.ru.toLowerCase().includes(q) || (w.cat||"").toLowerCase().includes(q))
      .sort((a,b)=> (a.cat||"").localeCompare(b.cat||"") || a.en.localeCompare(b.en));
    $("list").innerHTML = rows.map((w,i) => `
      <div class="worditem">
        <div>
          <b>${escapeHtml(w.en)}</b> ‚Äî ${escapeHtml(w.ru)}
          ${w.cat ? `<span class="tag">${escapeHtml(w.cat)}</span>` : ""}
        </div>
        <div class="row">
          <button onclick="editWord(${i})">‚úèÔ∏è</button>
          <button class="danger" onclick="delWord(${i})">üóëÔ∏è</button>
        </div>
      </div>
    `).join("") || `<div class="muted">–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç</div>`;
  }

  function escapeHtml(s){ return (s||"").replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m])); }

  // ======= CRUD =======
  function addWord(){
    const en = $("en").value.trim();
    const ru = $("ru").value.trim();
    const cat = $("cat").value.trim();
    if (!en || !ru) { alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∞–Ω–≥–ª–∏–π—Å–∫–æ–µ —Å–ª–æ–≤–æ –∏ –ø–µ—Ä–µ–≤–æ–¥"); return; }
    state.words.push({en, ru, cat});
    saveWords(); $("en").value=""; $("ru").value=""; $("cat").value="";
    renderCounts(); renderList();
  }
  function editWord(i){
    const w = state.words[i];
    const en = prompt("–ê–Ω–≥–ª–∏–π—Å–∫–æ–µ —Å–ª–æ–≤–æ:", w.en); if (en===null) return;
    const ru = prompt("–ü–µ—Ä–µ–≤–æ–¥:", w.ru); if (ru===null) return;
    const cat = prompt("–ö–∞—Ç–µ–≥–æ—Ä–∏—è:", w.cat||""); if (cat===null) return;
    state.words[i] = {en:en.trim(), ru:ru.trim(), cat:cat.trim()};
    saveWords(); renderCounts(); renderList();
  }
  function delWord(i){
    if (!confirm("–£–¥–∞–ª–∏—Ç—å —Å–ª–æ–≤–æ?")) return;
    state.words.splice(i,1);
    saveWords(); renderCounts(); renderList();
  }

  // ======= –ö–≤–∏–∑ =======
  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j = Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }
  function sample(arr, n){
    const copy = arr.slice(); shuffle(copy); return copy.slice(0, n);
  }

  function startQuiz(){
    const poolCat = $("filterCat").value;
    const mode = $("mode").value;
    const pool = state.words.filter(w => !poolCat || (w.cat||"")===poolCat);
    if (pool.length < 4) { alert("–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 4 —Å–ª–æ–≤–∞ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏/–±–∞–∑–µ."); return; }
    const len = Math.min(parseInt($("quizLen").value,10), pool.length);

    state.quiz = { mode, pool: shuffle(pool.slice()), len };
    state.current = 0; state.score = 0;
    $("score").textContent = "0"; $("total").textContent = len;
    $("quizArea").style.display = "block";
    nextQuestion();
  }

  function nextQuestion(){
    const {mode, pool, len} = state.quiz;
    $("feedback").textContent = "";
    $("nextBtn").disabled = true;
    if (state.current >= len){ // –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
      const percent = Math.round(100 * state.score / len);
      alert(`–ì–æ—Ç–æ–≤–æ! –†–µ–∑—É–ª—å—Ç–∞—Ç: ${state.score} –∏–∑ ${len} (${percent}%)`);
      $("quizArea").style.display = "none";
      return;
    }
    const item = pool[state.current % pool.length];
    const askEN = mode==="en2ru" ? true : mode==="ru2en" ? false : Math.random() < 0.5;
    const question = askEN ? item.en : item.ru;
    const correct = askEN ? item.ru : item.en;

    const allAnswers = [...new Set(pool.map(w => askEN ? w.ru : w.en))];
    const options = [correct, ...sample(allAnswers.filter(x => x !== correct), 3)];
    shuffle(options);

    $("qCounter").textContent = `${state.current+1}/${len}`;
    $("qCat").textContent = item.cat || "–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏";
    $("qHint").textContent = askEN ? "EN ‚Üí RU" : "RU ‚Üí EN";
    $("qWord").textContent = question;

    const answersDiv = $("answers");
    answersDiv.innerHTML = "";
    options.forEach(opt => {
      const btn = document.createElement("button");
      btn.textContent = opt;
      btn.onclick = () => selectAnswer(btn, opt, correct);
      answersDiv.appendChild(btn);
    });
  }

  function selectAnswer(btn, chosen, correct){
    const buttons = [...$("answers").querySelectorAll("button")];
    buttons.forEach(b => b.disabled = true);
    if (chosen === correct){
      btn.classList.add("ok");
      state.score++; $("score").textContent = state.score;
      $("feedback").textContent = "–í–µ—Ä–Ω–æ!";
    } else {
      btn.classList.add("bad");
      const rightBtn = buttons.find(b => b.textContent===correct);
      if (rightBtn) rightBtn.classList.add("ok");
      $("feedback").textContent = `–ù–µ–≤–µ—Ä–Ω–æ. –ü—Ä–∞–≤–∏–ª—å–Ω–æ: ${correct}`;
    }
    $("nextBtn").disabled = false;
  }

  // ======= –≠–∫—Å–ø–æ—Ä—Ç/–ò–º–ø–æ—Ä—Ç/–°–±—Ä–æ—Å =======
  function exportJSON(){
    const blob = new Blob([JSON.stringify(state.words, null, 2)], {type:"application/json"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "words.json";
    a.click();
    URL.revokeObjectURL(a.href);
  }
  function importJSON(file){
    const reader = new FileReader();
    reader.onload = e => {
      try {
        const arr = JSON.parse(e.target.result);
        if (!Array.isArray(arr)) throw new Error("bad");
        // –ø—Ä–æ—Å—Ç–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
        const cleaned = arr
          .filter(o => o && typeof o.en==="string" && typeof o.ru==="string")
          .map(o => ({en:o.en.trim(), ru:o.ru.trim(), cat:(o.cat||"").trim()}));
        if (cleaned.length===0) { alert("–í —Ñ–∞–π–ª–µ –Ω–µ—Ç —Å–ª–æ–≤"); return; }
        if (!confirm(`–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å ${cleaned.length} —Å–ª–æ–≤? –¢–µ–∫—É—â–∞—è –±–∞–∑–∞ –±—É–¥–µ—Ç –¥–æ–ø–æ–ª–Ω–µ–Ω–∞.`)) return;
        state.words = [...state.words, ...cleaned];
        saveWords(); renderCounts(); renderList();
      } catch(err){
        alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª.");
      }
    };
    reader.readAsText(file);
  }
  function resetAll(){
    if (!confirm("–ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å —Å–ª–æ–≤–∞—Ä—è? –≠—Ç–æ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.")) return;
    localStorage.removeItem(KEY);
    state.words = [];
    renderCounts(); renderList();
  }

  // ======= –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π =======
  $("addBtn").onclick = addWord;
  ["en","ru","cat"].forEach(id => {
    $(id).addEventListener("keydown", e => { if (e.key==="Enter") addWord(); });
  });
  $("search").oninput = renderList;
  $("startBtn").onclick = startQuiz;
  $("nextBtn").onclick = () => { state.current++; nextQuestion(); };
  $("skipBtn").onclick = () => { state.current++; nextQuestion(); };
  $("exportBtn").onclick = exportJSON;
  $("importBtn").onclick = () => $("importFile").click();
  $("importFile").onchange = (e)=> { if (e.target.files?.[0]) importJSON(e.target.files[0]); };
  $("resetBtn").onclick = resetAll;

  // –ø–µ—Ä–≤–∏—á–Ω–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞
  renderCounts(); renderList();
  </script>
</body>
</html>